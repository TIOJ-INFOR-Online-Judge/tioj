<% if @contest.persisted? %>
  <% set_page_title "Edit contest - " + @contest.title %>
<% else %>
  <% set_page_title "New contest" %>
<% end %>

<%= nested_form_for(@contest) do |f| %>
  <%= render partial: "shared/errors", locals: {errors: @contest.errors, item: 'contest'} %>

  <div class="mb-3">
    <%= f.label :title %>
    <%= f.text_field :title, class: 'form-control' %>
  </div>

  <div class="row">
    <div class="col-md-6 mb-3">
      <%= render 'contest_type_chooser', f: f %>
    </div>
  
    <div class="col-md-6 mb-3">
      <%= render 'register_mode_chooser', f: f %>
    </div>
  </div>

  <% alert_tag do %>
    <strong>Oh Geez! </strong><%= "If datetime picker isn't available, an example time format is `1996-12-19T16:39:57`." %>
  <% end %>

  <div class="row">
    <div class="col-md-4 mb-3">
      <%= f.label :register_before %>
      <%= f.datetime_local_field :register_before, class: 'form-control', type: 'datetime-local' %>
    </div>

    <div class="col-md-4 mb-3">
      <%= f.label :start_time %>
      <%= f.datetime_local_field :start_time, class: 'form-control', type: 'datetime-local' %>
    </div>

    <div class="col-md-4 mb-3">
      <%= f.label :end_time %>
      <%= f.datetime_local_field :end_time, class: 'form-control', type: 'datetime-local' %>
    </div>
  </div>

  <div class="mb-3">
    <%= f.label :description, help_collapse_toggle('Description in contest', 'contestDescription') %>
    <div class="collapse" id="contestDescription">
      <div class="card bg-white mb-3">
        <div class="card-body small" style="line-height: 1.4;">
          This description will be shown to users that are able to submit to this contest after the contest is started (also after the contest is ended).<br>
          For unregistered users (only if registration is required) or guest users, "Description before contest" is shown even after the contest is started.
        </div>
      </div>
    </div>
    <%= f.text_area :description, class: 'form-control', rows: "9" %>
  </div>

  <div class="mb-3">
    <%= f.label :description_before_contest, 'Description before contest' %>
    <%= f.text_area :description_before_contest, class: 'form-control', rows: "9" %>
  </div>

  <div class="mb-3">
    <%= f.label :cd_time, 'Submission CD time' %>
    <%= f.number_field :cd_time, min: 0, max: 3600, class: 'form-control', required: true, value: @contest.cd_time %>
  </div>

  <div class="mb-3">
    <%= f.label :freeze_minutes, 'Scoreboard freezing period (in minutes, 0 to disable freezing)' %>
    <%= f.number_field :freeze_minutes, min: 0, class: 'form-control', required: true, value: @contest.freeze_minutes %>
  </div>

  <div class="d-flex flex-column gap-2 mb-3">
    <div class="form-check">
      <%= f.check_box :dashboard_during_contest, class: 'form-check-input' %>
      <%= f.label :dashboard_during_contest, 'Enable dashboard during contest', class: 'form-check-label' %>
    </div>
    <div class="form-check">
      <%= f.check_box :disable_discussion, class: 'form-check-input' %>
      <%= f.label :disable_discussion, 'Disable global and problem discussion during the contest', class: 'form-check-label' %>
    </div>
    <div class="form-check">
      <%= f.check_box :show_detail_result, class: 'form-check-input' %>
      <%= f.label :show_detail_result, 'Show detailed result of each testdata', class: 'form-check-label' %>
    </div>
    <div class="form-check">
      <%= f.check_box :skip_group, class: 'form-check-input' %>
      <%= f.label :skip_group, 'Skip the remaining testdata in the task if any of the testdata got non-AC', class: 'form-check-label' %>
    </div>
    <div class="form-check">
      <%= f.check_box :hide_old_submission, class: 'form-check-input' %>
      <%= f.label :hide_old_submission, 'Hide old submissions in contest problems', class: 'form-check-label' %>
    </div>
    <div class="form-check">
      <%= f.check_box :default_single_contest, class: 'form-check-input' %>
      <%= f.label :default_single_contest, 'Always go to Single Contest page by default for non-admin users', class: 'form-check-label' %>
    </div>
    <div class="form-check">
      <%= f.check_box :allow_team_register, class: 'form-check-input' %>
      <%= f.label :allow_team_register, 'Allow team registration', class: 'form-check-label' %>
    </div>
  </div>

  <div class="mb-3">
    <%= f.label :compilers, "Banned compilers" %>
    <div class="d-flex flex-wrap gap-1">
      <% Compiler.order(order: :asc).all.each do |c| %>
        <span class="button-checkbox">

          <%= button_tag c.name, type: "button", class: "btn", "data-color": "danger" %>
          <%= check_box_tag "contest[compiler_ids][]", c.id, @ban_compiler_ids.include?(c.id), hidden: true %> 
        </span>
      <% end %>
    </div>
  </div>

  <% alert_tag class: 'alert-success' do %>
    <strong>Oh Geez! </strong> <%= "Make sure tasks are set to `visible during contest`." %>
  <% end %>

  <%= f.fields_for :contest_problem_joints do |t| %>
    <div class="row mb-3 align-items-center">
      <div class="col-md-1">
        <%= t.label :task %>
      </div>
      <div class="col-md-2">
        <%= t.number_field :problem_id, class: 'form-control', autocomplete: "off" %>
      </div>
      <div class="col-md-3 mt-2">
        <%= t.link_to_remove "Remove this task", class: "btn btn-danger" %>
      </div>
    </div>
  <% end %>
  <div class="mb-3">
    <%= f.link_to_add "Add a task", :contest_problem_joints, class: "btn btn-warning" %>
  </div>

  <hr>

  <div>
    <%= f.submit class: "btn btn-success btn-lg"%>
  </div>
<% end %>

<script>
  buttonCheckboxSetup()
</script>
