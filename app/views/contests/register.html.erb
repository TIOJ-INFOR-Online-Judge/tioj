<h4 class="page-header">Edit registrations of <%= @contest.title %></h4>

<% if @registration.nil? %>

  <div class="mb-3">
    <%= form_with url: register_update_contest_path(@contest), local: true do |f| %>
      <div class="mb-3">
        <label>As team</label>
        <%= f.collection_select :team_id, @teams, :id, :teamname, {}, { class: 'form-control' } %>
      </div>
      <div class="mb-3">
        <%= contest_register_status(@registration&.approved, true) %>
        <%= f.submit 'Register', class: 'btn btn-success btn-sm' %>
      </div>
    <% end %>
  </div>

  <hr>

  <div class="mb-3">
    <%= form_with url: register_update_contest_path(@contest), local: true do |f| %>
      <div class="mb-3">
        <label>As individual</label>
      </div>
      <div class="mb-3">
        <%= contest_register_status(@registration&.approved, true) %>
        <%= f.submit 'Register', class: 'btn btn-success btn-sm' %>
      </div>
    <% end %>
  </div>

<% elsif @registration.team.nil? %>

  <div class="mb-3">
    <%= form_with url: register_update_contest_path(@contest), local: true do |f| %>
      <div class="mb-3">
        <label>As individual</label>
      </div>
      <div class="mb-3">
        <%= contest_register_status(@registration&.approved, true) %>
        <%= f.hidden_field :cancel, value: 1 %>
        <%= f.submit 'Unregister', class: 'btn btn-danger btn-sm' %>
      </div>
    <% end %>
  </div>

<% else %>

  <div class="mb-3">
    <%= form_with url: register_update_contest_path(@contest), local: true do |f| %>
      <div class="mb-3">
        <label>As team</label>
        <%=
          f.collection_select :team_id, @teams, :id, :teamname,
            { selected: @registration.user.id },
            { class: 'form-control', disabled: true }
          %>
        <%= f.hidden_field :cancel, value: 1 %>
        <%= f.hidden_field :team_id, value: @registration.team.id %>
      </div>

      <div class="mb-3">
        <%= contest_register_status(@registration&.approved, true) %>
        <%= f.submit 'Unregister', class: 'btn btn-danger btn-sm' %>
      </div>
    <% end %>
  </div>

  <label>
    Team <i><%= @registration.team.teamname %></i>
  </label>
  <table class="table table-hover table-striped table-sm">
    <thead>
      <tr>
        <th></th>
        <th>Username</th>
        <th>Nickname</th>
        <th>
          Register Status
        </th>
      </tr>
    </thead>
    <tbody>
      <% @teammate_registrations.each do |user, registration| %>
        <tr>
          <td>
            <%= link_to image_tag(user.avatar.mini_thumb.to_s, class: 'rounded'), user_path(user) %>
          </td>
          <td>
            <%= link_to user.username, user_path(user) %>
          </td>
          <td>
            <%= user.nickname %>
          </td>
          <td>
            <%= contest_register_status(registration&.approved, true) %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

<% end %>

<div>
  <%= link_to "Back", :back, class: 'btn btn-secondary btn-sm' %>
</div>
