<h4 class="page-header">Edit registrations of <%= @contest.title %></h4>

<% alert_tag do %>
  This contest allows team registration.
  <% if @registration.nil? || !@registration.persisted? %>
  You can register either as a team or as an individual.
  <% elsif @registration.team.nil? %>
  If you want to register as a team, please unregister first.
  <% else %>
  If you want to switch team or register as individual, please unregister first.
  <% end %>
<% end %>

<%= render partial: "shared/errors", locals: {errors: @registration&.errors, item: 'Registration'} %>

<% if @registration.nil? || !@registration.persisted? %>

  <div class="row">
    <div class="col-sm-9 col-md-6 col-lg-4">
      <div class="form-group">
        <%= form_with url: register_update_contest_path(@contest), local: true do |f| %>
          <div>Register as team</div>
          <%= f.collection_select :team_id, @teams, :id, :name, {}, { class: 'form-control flat' } %>
          <%= f.submit 'Register', class: 'btn btn-success btn-xs' %>
        <% end %>
      </div>

      <div class="form-group">
        <%= form_with url: register_update_contest_path(@contest), local: true do |f| %>
          <div>Register as individual</div>
          <div>
            <%= f.submit 'Register', class: 'btn btn-success btn-xs' %>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <hr>


<% elsif @registration.team.nil? %>

  <div class="form-group">
    <%= form_with url: register_update_contest_path(@contest), local: true do |f| %>
      <label>As individual</label>
      <div>
        <%= contest_register_status(@registration&.approved, true) %>
        <%= f.hidden_field :cancel, value: 1 %>
        <%= f.submit 'Unregister', class: 'btn btn-danger btn-xs' %>
      </div>
    <% end %>
  </div>

<% else %>

  <div class="form-group">
    <%= form_with url: register_update_contest_path(@contest), local: true do |f| %>
      <label>As team</label>
      <%=
        f.collection_select :team_id, @teams, :id, :name,
          { selected: @registration.user.id },
          { class: 'form-control flat', disabled: true }
        %>
      <%= f.hidden_field :cancel, value: 1 %>
      <%= f.hidden_field :team_id, value: @registration.team.id %>
      <%= contest_register_status(@registration&.approved, true) %>
      <%= f.submit 'Unregister', class: 'btn btn-danger btn-xs' %>
    <% end %>
  </div>

  <label>
  Team <i><%= @registration.team.name %></i>
  </label>
  <table class="table table-hover table-striped table-condensed">
    <thead>
      <tr>
        <th></th>
        <th>Username</th>
        <th>Nickname</th>
        <th>
          Register Status
        </th>
      </tr>
    </thead>
    <tbody>
      <% @teammate_registrations.each do |user, registration| %>
        <tr>
          <td>
            <%= link_to image_tag(user.avatar.mini_thumb.to_s, class: 'img-rounded'), user_path(user) %>
          </td>
          <td>
          <%= link_to user.username, user_path(user) %>
          </td>
          <td>
            <%= user.nickname %>
          </td>
          <td>
            <%= contest_register_status(registration&.approved, true) %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

<% end %>

<p>

<%= link_to 'Back to Contest', @contest, class: 'btn btn-default btn-xs' %>
