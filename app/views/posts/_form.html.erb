<% if @post.persisted? %>
  <% set_page_title "Edit post - " + @post.title %>
<% else %>
  <% set_page_title "New post" %>
  <%# set default value %>
  <% @post.user_visible = @contest == nil %>
<% end %>

<% if @contest %>
  <% form_target = @post %>
  <% form_url = contest_adaptive_polymorphic_path([@post]) %>
<% else %>
  <% form_target = @postable ? [@postable, @post] : @post %>
  <% form_url = @postable ? [@postable, @post] : @post %>
<% end %>
<%= form_for form_target, url: form_url do |f| %>
  <%= render partial: "shared/errors", locals: {errors: @post.errors, item: 'post'} %>

  <div class="mb-3">
    <%= f.label :title, "Title:" %> <br />
    <%= f.text_field :title, class: 'form-control', placeholder:'Title' %>
  </div>
  <% if not @contest %>
    <div class="mb-3">
      <%= f.label :post_type %>
      <%= f.select :post_type, @post_types, {}, {class: 'form-control flat'} %>
    </div>
  <% end %>
  <div class="mb-3">
    <%= f.label :content, raw('Content: (all characters are rendered with <a href="https://guides.github.com/features/mastering-markdown/" >Markdown</a>)') %>
    <%= f.text_area :content, class: 'form-control flat', rows: 6, placeholder:'Content'%>
  </div>
  <% if allow_set_visibility %>
    <div class="mb-3 form-check">
        <%= f.check_box :global_visible, class: 'form-check-input' %>
        <%= f.label :global_visible, class: 'form-check-label' do %>
        Visible to anyone<% if @contest %> (pinned) <% end %>
      <% end %>
    </div>
    <div class="mb-3 form-check">
      <%= f.check_box :user_visible, class: 'form-check-input' %>
      <%= f.label :user_visible, class: 'form-check-label' do %>
        Username visible to anyone
      <% end %>
    </div>
  <% end %>
  <div class="mb-3">
    <%= f.submit class:"btn btn-primary" %>
  </div>
<% end %>

